# 澳门六合彩预测机器人 (Macau Lottery Telegram Bot)

完整的澳门六合彩Telegram预测机器人，提供智能预测、数据分析、自动通知等功能。

## ✨ 功能特点

### 🎯 智能预测
- **AI综合预测**: 多因素综合分析（频率35% + 遗漏30% + 生肖25% + 随机10%）
- **生肖预测**: 基于生肖周期分析
- **热号预测**: 近期高频号码统计
- **冷号预测**: 长期未出号码分析

### 📊 数据分析
- **频率分析**: 号码出现频次统计（Top 10）
- **生肖分布**: 12生肖出现比例分析
- **遗漏分析**: 长期未出号码追踪（Top 15）
- **冷热对比**: 冷热号码对比分析

### 📜 历史记录
- 支持查询最近10/20/30/50期开奖结果
- 显示完整开奖信息（期号、号码、特码、生肖）

### ⚙️ 个人设置
- **开奖通知**: 自动推送最新开奖结果
- **开奖提醒**: 21:00提前提醒
- **自动预测**: 开奖后自动预测下期

### 🤖 自动化功能
- 智能检测新开奖（21:30-21:40每分钟检测，其他时间每5分钟）
- 自动保存开奖结果到数据库
- 自动通知所有已启用通知的用户
- 每日21:00发送提醒（需启用）

## 🚀 快速开始

### 1. 环境要求
- Python 3.8+
- pip

### 2. 安装依赖

```bash
pip install -r requirements.txt
```

### 3. 配置环境变量

创建 `.env` 文件：

```bash
cp .env.example .env
```

编辑 `.env` 文件，填入你的配置：

```env
# 必填：Telegram Bot Token（从 @BotFather 获取）
TELEGRAM_BOT_TOKEN=your_bot_token_here

# 可选：管理员用户ID
ADMIN_USER_ID=123456789

# 检测间隔（分钟）
CHECK_INTERVAL=5

# 数据库路径
DATABASE_PATH=lottery.db

# 时区
TIMEZONE=Asia/Shanghai

# 开奖时间
LOTTERY_TIME=21:32:32
```

### 4. 运行机器人

```bash
python bot.py
```

或使用后台运行：

```bash
nohup python bot.py > bot.log 2>&1 &
```

## 📖 使用说明

### 基本命令

- `/start` - 启动机器人，显示主菜单

### 主菜单功能

1. **🎯 智能预测**
   - AI综合预测
   - 生肖预测
   - 热号预测
   - 冷号预测

2. **📊 最新开奖**
   - 查看最新期开奖结果
   - 显示完整信息和倒计时

3. **📈 数据分析**
   - 频率分析
   - 生肖分布
   - 遗漏分析
   - 冷热分析

4. **📜 历史记录**
   - 查询最近N期历史
   - 支持10/20/30/50期

5. **⚙️ 个人设置**
   - 切换开奖通知
   - 切换开奖提醒
   - 切换自动预测

6. **❓ 帮助**
   - 查看详细帮助信息

## 🗃️ 数据库结构

### lottery_history（开奖历史）
- `expect`: 期号
- `open_code`: 开奖号码（JSON）
- `tema`: 特码（第7个号码）
- `tema_zodiac`: 特码生肖
- `open_time`: 开奖时间

### user_settings（用户设置）
- `user_id`: 用户ID
- `notify_enabled`: 开奖通知开关
- `reminder_enabled`: 开奖提醒开关
- `auto_predict`: 自动预测开关
- `default_period`: 默认查询期数

### prediction_history（预测历史）
- `expect`: 期号
- `predicted_top5`: 预测的TOP5号码
- `actual_tema`: 实际特码
- `is_hit`: 是否命中
- `hit_rank`: 命中排名

## 🎲 生肖映射

```python
ZODIAC_NUMBERS = {
    '鼠': [12, 24, 36, 48],
    '牛': [11, 23, 35, 47],
    '虎': [10, 22, 34, 46],
    '兔': [9, 21, 33, 45],
    '龙': [8, 20, 32, 44],
    '蛇': [7, 19, 31, 43],
    '马': [6, 18, 30, 42],
    '羊': [5, 17, 29, 41],
    '猴': [4, 16, 28, 40],
    '鸡': [3, 15, 27, 39],
    '狗': [2, 14, 26, 38, 50],  # 50 is a special rare case
    '猪': [1, 13, 25, 37, 49]
}
```

**注意**: 数字50为特殊号码，仅在生肖"狗"中包含，实际开奖中极为罕见。预测算法主要针对1-49号码。

## 🔧 API接口

- **最新开奖**: `https://macaumarksix.com/api/macaujc2.com`
- **实时数据**: `https://macaumarksix.com/api/live2`
- **历史数据**: `https://history.macaumarksix.com/history/macaujc2/y/{year}`

## 🧮 预测算法

### AI综合预测权重分配：
1. **频率分析** (35%): 统计号码历史出现频率
2. **遗漏分析** (30%): 分析号码未出现期数
3. **生肖周期** (25%): 基于生肖分布规律
4. **随机因子** (10%): 增加预测多样性

### 预测流程：
1. 获取最近100期历史数据
2. 计算各号码的综合得分
3. 返回得分最高的TOP5号码
4. 保存预测记录到数据库

## 📅 定时任务

- **智能检测**: 
  - 21:30-21:40: 每分钟检测一次
  - 其他时间: 每5分钟检测一次
  
- **每日提醒**: 
  - 每天21:00发送开奖提醒（需启用）

## ⚠️ 免责声明

本机器人仅供娱乐和学习参考使用，预测结果基于统计分析，不构成任何投资建议。请理性娱乐，谨慎决策。

## 📝 日志

日志文件：`lottery_bot.log`

日志级别：INFO

包含内容：
- 机器人启动/停止
- 新开奖检测
- 用户通知发送
- API调用错误
- 数据库操作

## 🛠️ 技术栈

- **Python**: 3.8+
- **python-telegram-bot**: 20.7
- **SQLite**: 3
- **APScheduler**: 3.10.4
- **Requests**: 2.31.0
- **pytz**: 时区支持

## 📦 项目结构

```
fcbot/
├── bot.py              # 主程序文件
├── requirements.txt    # Python依赖
├── .env.example       # 环境变量示例
├── .env              # 环境变量（需自行创建）
├── lottery.db        # SQLite数据库（自动创建）
├── lottery_bot.log   # 日志文件（自动创建）
└── README.md         # 项目文档
```

## 🔒 安全建议

1. 不要将 `.env` 文件提交到版本控制
2. 定期备份 `lottery.db` 数据库
3. 使用 HTTPS 代理（如需要）
4. 限制管理员权限

## 🐛 故障排除

### Bot无法启动
- 检查 `TELEGRAM_BOT_TOKEN` 是否正确
- 确认网络连接正常
- 查看 `lottery_bot.log` 错误信息

### 无法接收通知
- 确认用户已发送 `/start` 命令
- 检查通知设置是否已启用
- 确认机器人正在运行

### 数据库错误
- 删除 `lottery.db` 重新初始化
- 检查文件权限

## 📄 许可证

MIT License

## 👨‍💻 维护

如有问题或建议，请联系管理员。

---

**最后更新**: 2024

**版本**: 1.0.0
